{% extends '../base.html' %}
{% load static %}
{% block content %}
    <h1 class="red">Display cities</h1>  
    <div class="row">
        <div class="col-md-6">
            <h5>Search for hotels in a city</h5>            
            <form id="search-form" action="{% url 'city:city-hotels2' %}">
                <div class="form-group">
                    {{search_city_form.media}}
                    {{search_city_form}}
                </div>                
                <button type="submit" class="btn-success">Find city</button>
            </form>
        </div>
        <div class="col-md-6">
            <ul class="list-group">
                {% if cities %}
                    {% for city in cities %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">                                    
                    <strong>
                        <span class='show'>                        
                            <a class ='get-hotels' href="{% url 'city:city-hotels' city %}">{{city}}</a>                   
                        </span>
                    </strong>                    
                    <span class="badge badge-primary badge-pill">{{city.hotels.count}}</span>
                    </li>
                    {% endfor %}
                {% else %}
                    <div class="empty">No cities</div>    
                {% endif %}     
                
            </ul>
        </div>              
    </div>     
    <div>
        <div id="hotel-list" >            
        </div>
    </div>     
{% endblock %}

{% block js %}
<script type="text/javascript">
    $(".get-hotels").on('click',function(e){
        let hotelList = $("#hotel-list");
        hotelList.text("");
        e.preventDefault();
        let url = $(this).attr("href")
        $.get(url,(response)=>{
            let rawResp = response.hotels;
            let hotels = JSON.parse(rawResp)
            hotels.forEach((item)=>{
                let wrapDiv = document.createElement('div');
                let hotelLink = document.createElement('a');                
                // from api point: name,id = item.id (can be used to create hotel detail url)
                hotelLink.setAttribute("href", "#");
                wrapDiv.className = 'hotel-content';
                hotelLink.textContent = item['name'];
                wrapDiv.append(hotelLink);
                hotelList.append(wrapDiv);
            })
        })
    })  
    // submit search form with auto-complete
    $('#search-form').on('submit',function(e){
        let hotelList = $("#hotel-list");
        hotelList.text("");
        e.preventDefault();
        let url = $(this).attr('action');
        console.log('urrrl',url)
        let data = {"city":"Amsterdam"}
        $.ajax({
            url:url,
            type:'GET',
            data:$(this).serialize(),
            success:function(resp){
                //console.log(resp)
                let rawResp = resp.hotels;
                let hotels = JSON.parse(rawResp)

                hotels.forEach((item)=>{
                let wrapDiv = document.createElement('div');
                let hotelLink = document.createElement('a');                
                // from api point: name,id = item.id (can be used to create hotel detail url)
                hotelLink.setAttribute("href", "#");
                wrapDiv.className = 'hotel-content';
                hotelLink.textContent = item['name'];
                wrapDiv.append(hotelLink);
                hotelList.append(wrapDiv);
            })



            },
            error:function(err){
                console.log("error",err)
            }

        })

    })
    
</script>
{% endblock %}
    
 
           
           
        
